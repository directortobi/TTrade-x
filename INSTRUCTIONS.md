# Trade X Production Setup Guide

## 1. Environment Variables
On your deployment platform (Netlify, Vercel, etc.), add these Environment Variables:
- `VITE_SUPABASE_URL`: Your project URL from Supabase Settings > API.
- `VITE_SUPABASE_ANON_KEY`: Your Anon/Public key from Supabase.
- `VITE_API_KEY`: Your Google Gemini API Key.

## 2. Database Schema (Supabase)
Run the following SQL in your Supabase SQL Editor to create the necessary tables and triggers:

```sql
-- Profiles Table
CREATE TABLE public.profiles (
    id UUID REFERENCES auth.users ON DELETE CASCADE PRIMARY KEY,
    email TEXT UNIQUE,
    tokens INTEGER DEFAULT 0,
    is_admin BOOLEAN DEFAULT FALSE,
    referral_code TEXT UNIQUE,
    referred_by TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Token Purchases Table
CREATE TABLE public.token_purchases (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES public.profiles(id),
    package_name TEXT,
    tokens_purchased INTEGER,
    price_usd NUMERIC,
    payment_proof_url TEXT,
    status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Analysis History Table
CREATE TABLE public.analysis_logs (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_email TEXT,
    symbol TEXT,
    signal TEXT,
    entry_price NUMERIC,
    stop_loss NUMERIC,
    take_profit_1 NUMERIC,
    confidence INTEGER,
    analysis_notes TEXT,
    outcome TEXT DEFAULT 'Pending',
    tokens_used INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Withdrawals Table
CREATE TABLE public.withdrawals (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES public.profiles(id),
    tokens_to_withdraw INTEGER,
    wallet_address TEXT,
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- New User Trigger
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger AS $$
BEGIN
  INSERT INTO public.profiles (id, email, referral_code, referred_by)
  VALUES (
    new.id, 
    new.email, 
    substring(md5(random()::text) from 1 for 8),
    (new.raw_user_meta_data->>'referred_by')
  );
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();
```

## 3. Storage Setup
1. In Supabase Dashboard, go to **Storage**.
2. Create a new bucket named `payment_proofs`.
3. Set the bucket to **Public**.

## 4. Deployment
1. Connect your GitHub repo to **Netlify**.
2. Build Command: `npm run build`
3. Publish Directory: `dist`
4. Netlify will automatically detect the `_redirects` file in the `public` folder to handle routing.